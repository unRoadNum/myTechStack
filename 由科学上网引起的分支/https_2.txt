## https的认证（二）

### CA是干什么的
***
CA中心又称CA机构，即证书授权中心(Certificate Authority )，或称证书授权机构。
作为电子商务交易中受信任的第三方，承担公钥体系中公钥的合法性检验的责任。

CA中心为每个使用公开密钥的用户发放一个数字证书。
数字证书的作用是证明证书中列出的用户合法拥有证书中列出的公开密钥。
CA机构的数字签名使得攻击者不能伪造和篡改证书。
在SET交易中，CA不仅对持卡人、商户发放证书，还要对获款的银行、网关发放证书。
它负责产生、分配并管理所有参与网上交易的个体所需的数字证书，因此是安全电子交易的核心环节。

### 以下内容来自知乎车老师
***
#CA的自签名数字证书是CA的RSA公钥，这个公钥预装在PC的操作系统里，由于是预装，我们绝对相信这个公钥是可信的。#

***
如果用这个公钥可以解密对方出示的任何证明材料，那么对方就是用CA私钥加密的！
既然CA私钥只有CA唯一知道，所以对方是CA的亲笔签名无疑！
RSA公钥是明文，所以任何人都可以得到CA的公钥，那谁唯一拥有CA的RSA私钥呢？废话！肯定是CA本人了！

为什么叫RSA公钥、私钥呢？
***
因为是运行RSA公钥算法，才可以得到一一对应的公钥、私钥。

公钥、私钥的特点
***
公钥加密的，私钥可以解密；
私钥加密的，公钥可以解密。

但公钥加密的，公钥无法解密；
私钥加密的，私钥也无法解密！

就是非对称加密。

数字证书认证
***
当服务器S向客户端C出示数字证书，其实是一个证书链
1） CA自签名证书（含有CA私钥签名的指纹）
2） CA给S签名的证书 （也含有CA私钥签名的指纹）

由于C拥有CA的公钥，1）验证成功2）用CA的公钥，成功验证是CA私钥的签名，于是信任服务器S的公钥，
因为证书2）里包含服务器的公钥Okay，获得了服务器S的公钥，也认证通过了，这时需要S与C协商用于加密数据的session key了。

session_key
***
有两个算法：

1）DH算法
S 筛选出自己的素数对 S1、S2
C筛选出自己的素数对 C1、C2
S与C交换各自的S2、C2
S拥有了S1、C2，
DH可以算出一个master key
C拥有了C1、S2，
DH可以算出一个master key
两个master key 完全一样！
这就是神奇的DH算法！
任何第三方都无法根据截获的S2、C2算出master key。
S、C用共同的公式，再推导出session key，
这个session key 只有S、C知晓，所以用此key 加密的数据是安全的、第三方是无法破解的。
但如果浏览器把C1、S2导出到wireshark，
Wireshark是可以计算出master key，
再推导出session key 的，因为DH算法公开。那么就可以解密S、C之间的加密流量。

2）RSA算法
C随机选取一个master key ，
用S的公钥加密，S解密，得到明文的master key，
剩下过程和DH算法类似，不在重复！
如果浏览器把master key 导出到wireshark 里，
同样也可以解密用户流量。

看，整个过程就是一个逻辑推理题，但不容许任何一步是逻辑错误的！
其实，严格意义上来说，Wireshark破解流量不算中间人攻击，是客户端主动泄密的结果，用于debug 、trouble shooting 而已。
如果题主的客户端不主动泄密(like wireshark)，试问谁可以破解https流量呢？





